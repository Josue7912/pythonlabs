/*!/wp-content/plugins/al-fb-reviews/assets/scripts/al-main-script.js*/
function setWrapperHeight(slideWrapper,offset){var columns=parseInt(slideWrapper.attr("data-columns"));var nextReviews=null;var children=slideWrapper.find(".al-slide-wrapper").children();if(offset<0){nextReviews=children.slice(offset);nextReviews=nextReviews.add(children.slice(0,columns+offset))}else{nextReviews=children.slice(offset,columns+offset)}
var maxHeight=Math.max.apply(null,nextReviews.map(function(){return jQuery(this).outerHeight()}).get());slideWrapper.find(".al-slide-wrapper").height(maxHeight)}
function stopSliderTiming(slideWrapper){clearTimeout(slideWrapper.data("timer"))}
function startSliderTiming(slideWrapper,timing){stopSliderTiming(slideWrapper);var timer=setTimeout(function(){nextReview(slideWrapper);startSliderTiming(slideWrapper,timing)},timing);slideWrapper.data("timer",timer)}
function getShiftIndex(slideWrapper,direction){var columns=parseInt(slideWrapper.attr("data-columns"));var columnShift=parseInt(slideWrapper.attr("data-shift"));if(columnShift==0)columnShift=columns;return slideWrapper.data("index")+columnShift*direction}
function prevReview(slideWrapper){goToReview(slideWrapper,getShiftIndex(slideWrapper,-1))}
function nextReview(slideWrapper){goToReview(slideWrapper,getShiftIndex(slideWrapper,1))}
function goToReview(slideWrapper,index){if(slideWrapper.data("can-slide")){var children=slideWrapper.find(".al-slide-wrapper").children();var currentIndex=slideWrapper.data("index");var deltaIndex=index-currentIndex;var newIndex=index%children.length;slideWrapper.data("index",newIndex);if(currentIndex==children.length-1&&newIndex==0){deltaIndex=1}else if(currentIndex==0&&newIndex==children.length-1){deltaIndex=-1}
slideWrapper.find(".al-reviews-slider-pagination li").removeClass("al-current").eq(newIndex).addClass("al-current");var columnShift=Math.abs(deltaIndex);if(slideWrapper.is(":visible")){if(deltaIndex>0){setWrapperHeight(slideWrapper,columnShift);slideWrapper.data("can-slide",!1);children.eq(0).on("transitionend",function(){jQuery(this).off("transitionend");slideWrapper.data("can-slide",!0);children.addClass("notransition");children.css("transform","");children[0].offsetHeight;children.removeClass("notransition");children.slice(0,columnShift).appendTo(slideWrapper.find(".al-slide-wrapper"))});children.css("transform","translate(-"+(columnShift*100)+"%, 0)")}else if(deltaIndex<0){setWrapperHeight(slideWrapper,-columnShift);slideWrapper.data("can-slide",!1);children.eq(0).on("transitionend",function(){jQuery(this).off("transitionend");slideWrapper.data("can-slide",!0)});children.slice(-columnShift).prependTo(slideWrapper.find(".al-slide-wrapper"));children.addClass("notransition");children.css("transform","translate(-"+(columnShift*100)+"%, 0)");children[0].offsetHeight;children.removeClass("notransition");children.css("transform","")}}else{children.eq(0).off("transitionend");children.css("transform","");children.slice(0,columnShift).appendTo(slideWrapper.find(".al-slide-wrapper"))}}}
function showMoreReviews(elem,button){var cols=parseInt(elem.attr("data-columns"));var newRows=parseInt(elem.attr("data-shift"));var visibleReviews=elem.children("div.visible").length;var nextVisible=null;if(newRows==0){nextVisible=elem.children("div").slice(visibleReviews)}else{nextVisible=elem.children("div").slice(visibleReviews,visibleReviews+newRows*cols)}
var currHeight=elem.outerHeight();elem.css("max-height",currHeight);elem.addClass("al-transition");nextVisible.addClass("visible");elem[0].offsetHeight;var maxHeight=elem[0].scrollHeight;elem.css("max-height",maxHeight);if(elem.children("div:not(.visible)").length==0){if(!elem.hasClass("fusion-child-element")){button.hide()}
elem.find(".reviews").children("div").addClass("visible");elem.find(".reviews").css("max-height","none")}}
function truncateTags(elem,charCount){var grabText='';var missCount=charCount;jQuery(elem).contents().each(function(){if(this.nodeType==Node.TEXT_NODE){var curText=this.data.replace(/\s\s|\n/g," ");grabText+=curText.substr(0,missCount);missCount-=Math.min(curText.length,missCount)}else if(this.nodeType==Node.ELEMENT_NODE){var childPart=truncateTags(this,missCount);grabText+=childPart.text;missCount-=childPart.count}
if(missCount==0){return!1}});return{text:elem.outerHTML.match(/^<[^>]+>/m)[0]+grabText+'</'+elem.localName+'>',count:charCount-missCount}}
function truncateTagsByWord(elem,wordCount){var words=jQuery(elem).text().trim().split(/[\s]+/).slice(0,wordCount);var charCount=0;for(var i=0;i<words.length;i++){charCount+=words[i].length+1}
return truncateTags(elem,charCount)}
function getAppendingElement(elem){var node=elem.contents().last();try{if(node[0].nodeType==Node.TEXT_NODE||node[0].tagName.toLowerCase()=="a"){return node.parent()}else{return node}}catch(err){console.log("[ArcticLune] Appended text is too long.");return null}}(function($){$.fn.shuffle=function(){var allElems=this.get();var getRandom=function(max){return Math.floor(Math.random()*max)};var shuffled=$.map(allElems,function(){var random=getRandom(allElems.length),randEl=$(allElems[random]).clone(!0)[0];allElems.splice(random,1);return randEl});this.each(function(i){$(this).replaceWith($(shuffled[i]))});return $(shuffled)}})(jQuery);function initFB_AL_Reviews(elem){elem=jQuery(".al-fb-reviews",elem);jQuery(".al-reviews-random").each(function(){jQuery(".review",this).shuffle()});jQuery(".al-reviews-slider").each(function(){var slideWrapper=jQuery(this);var slideTiming=slideWrapper.attr("data-timing")*1000;slideWrapper.data("index",0);slideWrapper.data("can-slide",!0);slideWrapper.on("mouseenter",function(){stopSliderTiming(slideWrapper)});slideWrapper.on("mouseleave",function(){startSliderTiming(slideWrapper,slideTiming)});slideWrapper.find(".al-reviews-slider-arrow-left").on("click",function(){stopSliderTiming(slideWrapper);prevReview(slideWrapper)});slideWrapper.find(".al-reviews-slider-arrow-right").on("click",function(){stopSliderTiming(slideWrapper);nextReview(slideWrapper)});slideWrapper.find(".al-reviews-slider-pagination li").eq(0).addClass("al-current");slideWrapper.find(".al-reviews-slider-pagination li").on("click",function(){stopSliderTiming(slideWrapper);var index=jQuery(this).index();goToReview(slideWrapper,index)});setTimeout(setWrapperHeight,100,slideWrapper,0);startSliderTiming(slideWrapper,slideTiming)});jQuery(".al-reviews-grid").each(function(){var currentContainer=jQuery(this);var initialRows=parseInt(currentContainer.attr("data-initial-rows"));if(initialRows==0){currentContainer.css("max-height","none");currentContainer.children(".review, .fusion-builder-live-child-element").addClass("visible")}else{var cols=parseInt(currentContainer.attr("data-columns"));currentContainer.children(".review, .fusion-builder-live-child-element").slice(0,initialRows*cols).addClass("visible");currentContainer[0].offsetHeight;var currHeight=currentContainer[0].scrollHeight;currentContainer.css("max-height","none");var hideButton=!1;if(!currentContainer.hasClass("fusion-child-element")&&currentContainer.children(".review:not(.visible), .fusion-builder-live-child-element:not(.visible)").length==0){hideButton=!0}
var buttonID=currentContainer.attr("data-button-id");if(buttonID!=undefined){if(hideButton){jQuery("#"+buttonID).hide()}else{jQuery("#"+buttonID).on("click",function(e){e.preventDefault();showMoreReviews(currentContainer,jQuery(this))})}}else{if(hideButton){currentContainer.siblings(".al-grid-show-more").find("> div").hide()}else{currentContainer.siblings(".al-grid-show-more").find("> div").on("click",function(){showMoreReviews(currentContainer,jQuery(this))})}}}
currentContainer.on("transitionend",function(){currentContainer.removeClass("al-transition");currentContainer.css("max-height","none")})});jQuery(".al-truncate-char",elem).each(function(){var truncLength=parseInt(jQuery(this).attr("data-trunc"));var doShowLess=jQuery(this).hasClass("al-truncate-showless");if(jQuery(".review-body-short",this).text().trim().length>truncLength){var truncText=jQuery(this).attr("data-trunc-text");var truncLink=jQuery(this).attr("data-trunc-linktext");var truncTextContent='<span class="al-trunctext">'+truncText+'</span>';var truncLinkContent='<a href="javascript:void(0);" class="al-readmore">'+truncLink+'</a>';var truncLinkStyle=jQuery(this).attr("data-trunc-linkstyle");var showLessLinkContent='';var showLessLinkStyle='';if(doShowLess){showLessLinkContent='<a href="javascript:void(0);" class="al-readless">'+jQuery(this).attr("data-showless-text")+'</a>';showLessLinkStyle=jQuery(this).attr("data-showless-style")}
var truncAppendLength=0;var truncAppend="";if(truncLinkStyle=="inline"){truncAppend=truncTextContent+' '+truncLinkContent}else if(truncLinkStyle=="below"){truncAppend=truncTextContent}
jQuery(".review-body-short",this).each(function(){var newContent=truncateTags(this,truncLength-truncAppendLength).text;jQuery(this).html(newContent);var appElement=getAppendingElement(jQuery(".review-body",this));if(appElement!=null){appElement.append(truncAppend);if(truncLinkStyle=="below"){jQuery(".review-body",this).append("<p>"+truncLinkContent+"</p>")}
var newShort=jQuery(".review-body",this).unwrap();if(doShowLess){var appElementFull=getAppendingElement(newShort.siblings(".review-body-full"));if(appElementFull!=null){if(showLessLinkStyle=="below"){newShort.siblings(".review-body-full").append("<p>"+showLessLinkContent+"</p>")}else{appElementFull.append(showLessLinkContent)}}}}})}});jQuery(".al-truncate-word",elem).each(function(){var truncLength=parseInt(jQuery(this).attr("data-trunc"));var doShowLess=jQuery(this).hasClass("al-truncate-showless");if(jQuery(".review-body-short",this).text().trim().split(/[\s]+/).length>truncLength){var truncText=jQuery(this).attr("data-trunc-text");var truncLink=jQuery(this).attr("data-trunc-linktext");var truncTextContent='<span class="al-trunctext">'+truncText+'</span>';var truncLinkContent='<a href="javascript:void(0);" class="al-readmore">'+truncLink+'</a>';var truncLinkStyle=jQuery(this).attr("data-trunc-linkstyle");var showLessLinkContent='';var showLessLinkStyle='';if(doShowLess){showLessLinkContent='<a href="javascript:void(0);" class="al-readless">'+jQuery(this).attr("data-showless-text")+'</a>';showLessLinkStyle=jQuery(this).attr("data-showless-style")}
var truncAppendLength=0;var truncAppend="";if(truncLinkStyle=="inline"){truncAppend=truncTextContent+' '+truncLinkContent}else if(truncLinkStyle=="below"){truncAppend=truncTextContent}
jQuery(".review-body-short",this).each(function(){var newContent=truncateTagsByWord(this,truncLength-truncAppendLength).text;jQuery(this).html(newContent);var appElement=getAppendingElement(jQuery(".review-body",this));if(appElement!=null){appElement.append(truncAppend);if(truncLinkStyle=="below"){jQuery(".review-body",this).append("<p>"+truncLinkContent+"</p>")}
var newShort=jQuery(".review-body",this).unwrap();if(doShowLess){var appElementFull=getAppendingElement(newShort.siblings(".review-body-full"));if(appElementFull!=null){if(showLessLinkStyle=="below"){newShort.siblings(".review-body-full").append("<p>"+showLessLinkContent+"</p>")}else{appElementFull.append(showLessLinkContent)}}}}})}});jQuery(".al-truncate-line",elem).each(function(){var doShowLess=jQuery(this).hasClass("al-truncate-showless");var truncText=jQuery(this).attr("data-trunc-text");var truncLink=jQuery(this).attr("data-trunc-linktext");var truncTextContent='<span class="al-trunctext">'+truncText+'</span>';var truncLinkContent='<a href="javascript:void(0);" class="al-readmore">'+truncLink+'</a>';var truncLinkStyle=jQuery(this).attr("data-trunc-linkstyle");var truncAppendLength=0;var truncAppend="";if(truncLinkStyle=="inline"){truncAppendLength=truncText.length+1+truncLink.length;truncAppend=truncTextContent+' '+truncLinkContent}else if(truncLinkStyle=="below"){truncAppendLength=truncText.length;truncAppend=truncTextContent}
var showLessLinkContent='';var showLessLinkStyle='';if(doShowLess){showLessLinkContent='<a href="javascript:void(0);" class="al-readless">'+jQuery(this).attr("data-showless-text")+'</a>';showLessLinkStyle=jQuery(this).attr("data-showless-style")}
var maxHeight=parseInt(jQuery(".review-body-short",this).css("line-height"))*parseInt(jQuery(this).attr("data-trunc"));jQuery(".review",this).first().append('<div class="review-body review-body-linetest">'+truncAppend+'</div>');if(parseInt(jQuery(".review-body-linetest",this).height())>maxHeight){console.log("[ArcticLune] Appended text is too long.")}else{jQuery(".review-body-shave",this).each(function(){if(parseInt(jQuery(this).siblings(".review-body-short").height())>maxHeight){var currentContainer=jQuery(this).parent();jQuery(this).shave(maxHeight,{character:truncAppend,});jQuery(".js-shave",this).remove();var shortContainer=jQuery(this).siblings(".review-body-short");var fullContainer=jQuery(this).siblings(".review-body-full");var curLength=jQuery(this).text().trim().length-truncAppendLength;var curHeight=0;var newContent="";var tempContainer=jQuery(this);do{newContent=truncateTags(shortContainer[0],curLength).text;tempContainer.html(newContent);var appElement=getAppendingElement(tempContainer.find(".review-body"));if(appElement!=null){appElement.append(truncAppend);tempContainer=tempContainer.find(".review-body");newContent=tempContainer.contents();tempContainer.addClass("review-body-shave").removeClass("review-body-short").unwrap();curHeight=parseInt(tempContainer.css("height"));curLength--}else{tempContainer=null;break}}while(curHeight>maxHeight);if(tempContainer!=null){shortContainer.html(newContent);shortContainer=jQuery(".review-body-short",currentContainer);if(truncLinkStyle=="below"){shortContainer.append("<p>"+truncLinkContent+"</p>")}
if(doShowLess){var appElementFull=getAppendingElement(fullContainer);if(appElementFull!=null){if(showLessLinkStyle=="below"){fullContainer.append("<p>"+showLessLinkContent+"</p>")}else{appElementFull.append(showLessLinkContent)}}}}}})}
jQuery(".review-body-linetest",this).remove()});jQuery(".al-readmore",elem).on("click",function(){var parent=jQuery(this).closest(".review-body");var fullContainer=parent.siblings(".review-body-full");var height=parent.css("height");var reviewHeight=parseInt(jQuery(this).closest(".review").height());parent.hide();fullContainer.css("max-height",height);fullContainer.show();fullContainer[0].offsetHeight;var maxHeight=fullContainer[0].scrollHeight;fullContainer.css("max-height",maxHeight);fullContainer.on("transitionend",function(){fullContainer.css("max-height","")});var heightDiff=maxHeight-parseInt(height);var sliderHeight=fullContainer.closest(".al-reviews-slider").height();if(sliderHeight&&reviewHeight+heightDiff>sliderHeight){fullContainer.closest(".al-reviews-slider").height(sliderHeight+heightDiff)}});jQuery(".al-readless",elem).on("click",function(){var parent=jQuery(this).closest(".review-body");var shortContainer=parent.siblings(".review-body-short");var height=parent.css("height");var minHeight=shortContainer[0].scrollHeight;var reviewHeight=parseInt(jQuery(this).closest(".review").height());parent.hide();shortContainer.css("min-height",height);shortContainer.show();shortContainer[0].offsetHeight;shortContainer.css("min-height",minHeight);shortContainer.on("transitionend",function(){shortContainer.css("min-height","")})})}
jQuery(document).ready(function(){jQuery(window).on("resize",function(){jQuery(".al-reviews-slider").each(function(){setWrapperHeight(jQuery(this),0)})});initFB_AL_Reviews(document.body)})
;